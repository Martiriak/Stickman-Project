using System.Collections;
using UnityEngine;

namespace Stickman.Players
{
    public class InvulnerabilityAnimation : MonoBehaviour
    {
        private const float SingleBlinkDuration = 0.2f;

        [SerializeField] private SpriteRenderer m_renderer;
        [SerializeField] private SwordsmanLives m_swordsmanLives;

        private WaitForSeconds c_blinkDuration;

        private void Start()
        {
            m_swordsmanLives.OnInvulnerability += AnimateInvulnerability;
            c_blinkDuration = new WaitForSeconds(SingleBlinkDuration);
        }

        private void OnDestroy()
        {
            m_swordsmanLives.OnInvulnerability -= AnimateInvulnerability;
        }

        private void AnimateInvulnerability(bool isInvulnerable)
        {
            if (!isInvulnerable)
            {
                StopAllCoroutines();
                m_renderer.enabled = true;
            }
            else StartCoroutine(Blinking());
        }

        private IEnumerator Blinking()
        {
            while (true)
            {
                m_renderer.enabled = false;
                yield return c_blinkDuration;
                m_renderer.enabled = true;
                yield return c_blinkDuration;
            }
        }
    }
}